extends ../_templates/main

mixin appendPanelBtn(name, index)
  a(href='javascript:void(0);')
    .btn(data-toggle = 'collapse', data-target = `#t${index}`)
      h3 #{name}

mixin appendCharacterList(characters)
  each c in characters
    li.tile.small(style = 'flex:1 1 33%; margin:2px;')
      .char-button(data-char = c.id, data-toggle = 'modal', data-target = '.modal')
      img(src=`${app.urls.g}wiki/${c.avatar}`)
      span #{c.name}

append styles
  link(rel = 'stylesheet', href = '/css/browse.css')
  style.
    .tooltip-inner {
      max-width: 50vw;
    }
    .tooltip-inner img {
      width: 45vw;
      padding: 3px;
    }

append scripts
  script(src = '/js/browse.js')

block title
  title Pikan! Party - Browse

block content
  .container-fluid.my-1
    .row
      .col
        .browse-panel
          each t, i in [ 'ALL', 'SOUL', 'EIDO', 'SSR+', 'SSR', 'SR', 'R', 'SKIN', 'ðŸ˜­' ]
            +appendPanelBtn(t, i)
          #browse-parent
            each t, i in [ 'all', 'soul', 'eidolon', 'ssr+', 'ssr', 'sr', 'r', 'skin', 'ðŸ˜­' ]
              .collapse(id = `t${i}`, data-parent = '#browse-parent')
                ul.tile-list(style = 'display:flex; flex-wrap:wrap;')
                  -
                    const selector = t === 'ðŸ˜­'
                    ? e => e.loli
                    : [ 'soul', 'eidolon' ].includes(t)
                        ? e => e.id.startsWith(t.charAt(0))
                        : e => e.id.startsWith('k') && e.rarity.toLowerCase() === t
                    const selected = t === 'all' ? characters : characters.filter(selector)
                  +appendCharacterList(selected)
